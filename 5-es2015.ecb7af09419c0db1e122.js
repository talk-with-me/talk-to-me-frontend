(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{G6fN:function(n,l,t){"use strict";t.r(l);var e=t("8Y7J");class u{}var o=t("pMnS"),r=t("SVse");class i{constructor(n,l){this.service=n,this.router=l,this.loginSuccessful=!1,this.showingReportedMessages=!1}ngOnInit(){}attemptLogin(n){""!==n&&this.service.doAdminAuth(n).subscribe(n=>{this.loginSuccessful=this.service.isAuthed(),console.log(this.loginSuccessful),this.currentView="admin_buttons"})}viewReports(){console.log("viewing reports"),this.service.getReports().subscribe(n=>{n.success&&(this.reportsList=n.data)}),this.currentView="reports"}viewReportedMessages(n){this.showingReportedMessages?this.showingReportedMessages=!1:(console.log("viewing reported messages"),this.service.getReportedMessages(n).subscribe(n=>{n.success&&(this.reportedMessagesList=n.data)}),this.showingReportedMessages=!0)}viewBans(){console.log("viewing bans"),this.service.getBans().subscribe(n=>{n.success&&(this.bansList=n.data)}),this.currentView="bans"}banUser(n,l){""!==l&&(console.log(n),this.service.banUser(n,l).subscribe(n=>{console.log(n)}))}unbanUser(n){this.service.unbanUser(n).subscribe(n=>{console.log(n)})}}var s=t("LRne"),c=t("AytR"),a=t("JIr8"),p=t("lJxs"),b=(t("5+tZ"),t("Cfvw"),t("IheW"));const d=c.a.apiUrl+"/admin";new class{constructor(n=null){this.tokenGetter=n&&n.tokenGetter||function(){}}urlBase64Decode(n){let l=n.replace(/-/g,"+").replace(/_/g,"/");switch(l.length%4){case 0:break;case 2:l+="==";break;case 3:l+="=";break;default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(l)}b64decode(n){let l="";if((n=String(n).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let t,e,u=0,o=0;e=n.charAt(o++);~e&&(t=u%4?64*t+e:e,u++%4)?l+=String.fromCharCode(255&t>>(-2*u&6)):0)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e);return l}b64DecodeUnicode(n){return decodeURIComponent(Array.prototype.map.call(this.b64decode(n),n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(n=this.tokenGetter()){if(!n||""===n)return null;const l=n.split(".");if(3!==l.length)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");const t=this.urlBase64Decode(l[1]);if(!t)throw new Error("Cannot decode the token.");return JSON.parse(t)}getTokenExpirationDate(n=this.tokenGetter()){let l;if(l=this.decodeToken(n),!l||!l.hasOwnProperty("exp"))return null;const t=new Date(0);return t.setUTCSeconds(l.exp),t}isTokenExpired(n=this.tokenGetter(),l){if(!n||""===n)return!0;const t=this.getTokenExpirationDate(n);return l=l||0,null!==t&&!(t.valueOf()>(new Date).valueOf()+1e3*l)}getAuthScheme(n,l){return"function"==typeof n?n(l):n}};let h=(()=>{class n{constructor(n){this.http=n}doAdminAuth(n){return this.http.post(d+"/auth",{password:n}).pipe(Object(a.a)(n=>this.defaultErrorHandler(n))).pipe(Object(p.a)(n=>(n.success&&this.setAdminToken(n.data.authorization),n)))}getReports(){return this.http.get(d+"/reports",this.defaultAuthOptions()).pipe(Object(a.a)(n=>this.defaultErrorHandler(n)))}getReportedMessages(n){return this.http.get(`${d}/reports/${n}/messages`,this.defaultAuthOptions()).pipe(Object(a.a)(n=>this.defaultErrorHandler(n)))}banUser(n,l){return this.http.post(d+"/banuser",{report_id:n,reason:l},this.defaultAuthOptions()).pipe(Object(a.a)(n=>this.defaultErrorHandler(n)))}getBans(){return this.http.get(d+"/bannedusers",this.defaultAuthOptions()).pipe(Object(a.a)(n=>this.defaultErrorHandler(n)))}unbanUser(n){return this.http.post(d+"/unbanuser",{ip:n},this.defaultAuthOptions()).pipe(Object(a.a)(n=>this.defaultErrorHandler(n)))}isAuthed(){return null!==this.getAdminToken()}defaultErrorHandler(n){return console.error(n),403===n.status&&this.clearAdminToken(),Object(s.a)(Object.assign({},n.error,{status:n.status}))}defaultAuthOptions(n){return Object.assign({headers:{Authorization:this.getAdminToken()}},n)}setAdminToken(n){try{localStorage.setItem("admin-token",n)}catch(l){}}getAdminToken(){try{return localStorage.getItem("admin-token")}catch(n){return null}}clearAdminToken(){localStorage.removeItem("admin-token")}}return n.ngInjectableDef=e.Db({factory:function(){return new n(e.Eb(b.c))},token:n,providedIn:"root"}),n})();var g=t("iInd"),m=e.kb({encapsulation:0,styles:[["input[_ngcontent-%COMP%]{border:1px solid;border-radius:10px;padding-left:10px;width:100%;height:25px;background-color:#888}[_ngcontent-%COMP%]::-webkit-input-placeholder{color:#222}[_ngcontent-%COMP%]::-moz-placeholder{color:#222}[_ngcontent-%COMP%]::-ms-input-placeholder{color:#222}[_ngcontent-%COMP%]::placeholder{color:#222}.input_wrapper[_ngcontent-%COMP%]{width:min(100%,450px)}.inputBox[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-family:Arial,Helvetica,sans-serif}.input_button[_ngcontent-%COMP%]{border:1px solid #000;border-radius:10px;height:27px;width:50px;line-height:27px;font-size:14px;text-align:center;background-color:#888;cursor:pointer}.input_button[_ngcontent-%COMP%]:hover{background-color:#777}.ban_obj[_ngcontent-%COMP%]{min-height:27px;margin-bottom:10px;display:inline-flex;font-family:Arial,Helvetica,sans-serif}.unban_button[_ngcontent-%COMP%]{border:1px solid #000;border-radius:10px;height:27px;width:50px;line-height:27px;font-size:14px;text-align:center;background-color:#888;cursor:pointer}.admin_buttons[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.buttons[_ngcontent-%COMP%]{list-style-type:none;margin-top:15px;padding:0}.admin_button[_ngcontent-%COMP%]{display:block;text-align:center;padding:30px 100px;text-decoration:none;margin-top:20px;margin-bottom:10px;background-color:#999;border-radius:4px;border:1px solid;max-width:400px;font-family:Arial,Helvetica,sans-serif;font-size:15px;box-shadow:2px 2px #222;cursor:pointer}.admin_button[_ngcontent-%COMP%]:visited{color:#000}.admin_button[_ngcontent-%COMP%]:hover{background-color:#777}.report_content[_ngcontent-%COMP%]{width:200px;background-color:#999;border-radius:4px;border:1px solid;box-shadow:2px 2px #222}.reported_message_content[_ngcontent-%COMP%]{width:200px;background-color:#999;border-radius:4px;border:1px solid;box-shadow:2px 2px #222;margin-bottom:10px}.ban_content[_ngcontent-%COMP%]{max-width:min(100%,450px);background-color:#999;border-radius:4px;border:1px solid;box-shadow:2px 2px #222}ul[_ngcontent-%COMP%]{list-style-type:none}li[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{display:block;text-align:center;text-decoration:none;background-color:#999;border-radius:4px;border:1px solid;font-family:Arial,Helvetica,sans-serif;font-size:15px;box-shadow:2px 2px #222;max-width:200px;margin-bottom:10px;cursor:pointer}li[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]:visited{color:#000}li[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]:hover{background-color:#777}"]],data:{}});function f(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,7,"div",[["class","admin_buttons"]],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,6,"ul",[["class","buttons"]],null,null,null,null,null)),(n()(),e.mb(2,0,null,null,2,"li",[],null,null,null,null,null)),(n()(),e.mb(3,0,null,null,1,"a",[["class","admin_button"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.viewReports()&&e),e}),null,null)),(n()(),e.yb(-1,null,["View reports"])),(n()(),e.mb(5,0,null,null,2,"li",[],null,null,null,null,null)),(n()(),e.mb(6,0,null,null,1,"a",[["class","admin_button"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.viewBans()&&e),e}),null,null)),(n()(),e.yb(-1,null,["View bans"]))],null,null)}function x(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,1,"div",[["class","reported_message_content"]],null,null,null,null,null)),(n()(),e.yb(1,null,[" ",' "','" (',") "]))],null,(function(n,l){n(l,1,0,l.parent.context.$implicit.author,l.parent.context.$implicit.content,l.parent.context.$implicit.timestamp)}))}function w(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,3,"li",[],null,null,null,null,null)),e.lb(1,16384,null,0,r.k,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),e.bb(16777216,null,null,1,null,x)),e.lb(3,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,l){n(l,1,0,l.context.$implicit.room_id),n(l,3,0,l.parent.parent.context.$implicit.room_id)}),null)}function k(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,3,"div",[["class","reported_messages"]],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,2,"ul",[],null,null,null,null,null)),(n()(),e.bb(16777216,null,null,1,null,w)),e.lb(3,278528,null,0,r.h,[e.K,e.H,e.p],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,3,0,l.component.reportedMessagesList)}),null)}function v(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,12,"li",[],null,null,null,null,null)),e.lb(1,16384,null,0,r.k,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),e.mb(2,0,null,null,1,"div",[["class","report_content"]],null,null,null,null,null)),(n()(),e.yb(3,null,[" "," "," "," "," "," "," "])),(n()(),e.mb(4,0,null,null,4,"div",[["class","input_wrapper"]],null,null,null,null,null)),(n()(),e.mb(5,0,null,null,3,"div",[["class","inputBox"]],null,null,null,null,null)),(n()(),e.mb(6,0,[["banBox",1]],null,0,"input",[["placeholder","Ban reason"]],null,[[null,"keydown.enter"]],(function(n,l,t){var u=!0;return"keydown.enter"===l&&(n.component.banUser(n.context.$implicit._id,e.wb(n,6).value),u=!1!==(e.wb(n,6).value="")&&u),u}),null,null)),(n()(),e.mb(7,0,null,null,1,"a",[["class","input_button"]],null,[[null,"click"]],(function(n,l,t){var u=!0;return"click"===l&&(n.component.banUser(n.context.$implicit._id,e.wb(n,6).value),u=!1!==(e.wb(n,6).value="")&&u),u}),null,null)),(n()(),e.yb(-1,null,["Ban"])),(n()(),e.mb(9,0,null,null,1,"b",[],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.viewReportedMessages(n.context.$implicit.room_id)&&e),e}),null,null)),(n()(),e.yb(-1,null,["View reported messages"])),(n()(),e.bb(16777216,null,null,1,null,k)),e.lb(12,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,l){n(l,1,0,l.component.showingReportedMessages),n(l,12,0,!0)}),(function(n,l){n(l,3,0,l.context.$implicit.reporter,l.context.$implicit.reporter_ip,l.context.$implicit.reported,l.context.$implicit.reported_ip,l.context.$implicit.reason,l.context.$implicit.room_id)}))}function _(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,3,"div",[["class","reports"]],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,2,"ul",[],null,null,null,null,null)),(n()(),e.bb(16777216,null,null,1,null,v)),e.lb(3,278528,null,0,r.h,[e.K,e.H,e.p],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,3,0,l.component.reportsList)}),null)}function O(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,5,"li",[],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,4,"div",[["class","ban_obj"]],null,null,null,null,null)),(n()(),e.mb(2,0,null,null,1,"div",[["class","ban_content"]],null,null,null,null,null)),(n()(),e.yb(3,null,[" ",' "','" (',") "])),(n()(),e.mb(4,0,null,null,1,"a",[["class","unban_button"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.unbanUser(n.context.$implicit.ip)&&e),e}),null,null)),(n()(),e.yb(-1,null,["Unban"]))],null,(function(n,l){n(l,3,0,l.context.$implicit.ip,l.context.$implicit.reason,l.context.$implicit.date)}))}function C(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,3,"div",[["class","bans"]],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,2,"ul",[],null,null,null,null,null)),(n()(),e.bb(16777216,null,null,1,null,O)),e.lb(3,278528,null,0,r.h,[e.K,e.H,e.p],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,3,0,l.component.bansList)}),null)}function y(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,7,"div",[["class","admin_main"]],null,null,null,null,null)),e.lb(1,16384,null,0,r.k,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),e.bb(16777216,null,null,1,null,f)),e.lb(3,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null),(n()(),e.bb(16777216,null,null,1,null,_)),e.lb(5,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null),(n()(),e.bb(16777216,null,null,1,null,C)),e.lb(7,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,l){n(l,1,0,l.component.currentView),n(l,3,0,"admin_buttons"),n(l,5,0,"reports"),n(l,7,0,"bans")}),null)}function M(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,4,"div",[["class","input_wrapper"]],null,null,null,null,null)),(n()(),e.mb(1,0,null,null,3,"div",[["class","inputBox"]],null,null,null,null,null)),(n()(),e.mb(2,0,[["passBox",1]],null,0,"input",[["placeholder","Enter password"]],null,[[null,"keydown.enter"]],(function(n,l,t){var u=!0;return"keydown.enter"===l&&(n.component.attemptLogin(e.wb(n,2).value),u=!1!==(e.wb(n,2).value="")&&u),u}),null,null)),(n()(),e.mb(3,0,null,null,1,"a",[["class","input_button"]],null,[[null,"click"]],(function(n,l,t){var u=!0;return"click"===l&&(n.component.attemptLogin(e.wb(n,2).value),u=!1!==(e.wb(n,2).value="")&&u),u}),null,null)),(n()(),e.yb(-1,null,["Login"]))],null,null)}function S(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,5,"div",[],null,null,null,null,null)),e.lb(1,16384,null,0,r.k,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),e.bb(16777216,null,null,1,null,y)),e.lb(3,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null),(n()(),e.bb(16777216,null,null,1,null,M)),e.lb(5,278528,null,0,r.l,[e.K,e.H,r.k],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,l){n(l,1,0,l.component.loginSuccessful),n(l,3,0,!0),n(l,5,0,!1)}),null)}function A(n){return e.zb(0,[(n()(),e.mb(0,0,null,null,1,"ttm-admin",[],null,null,null,S,m)),e.lb(1,114688,null,0,i,[h,g.k],null,null)],(function(n,l){n(l,1,0)}),null)}var P=e.ib("ttm-admin",i,A,{},{},[]);class j{}t.d(l,"AdminModuleNgFactory",(function(){return H}));var H=e.jb(u,[],(function(n){return e.ub([e.vb(512,e.j,e.U,[[8,[o.a,P]],[3,e.j],e.u]),e.vb(4608,r.j,r.i,[e.r,[2,r.s]]),e.vb(1073742336,r.b,r.b,[]),e.vb(1073742336,g.l,g.l,[[2,g.q],[2,g.k]]),e.vb(1073742336,j,j,[]),e.vb(1073742336,u,u,[]),e.vb(1024,g.i,(function(){return[[{path:"",component:i}]]}),[])])}))}}]);